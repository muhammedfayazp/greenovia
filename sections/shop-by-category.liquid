{% assign count = section.blocks.size %}

<section class="shopbycat">
  <div class="shopbycat__container page-width">

    <div class="shopbycat__head">
      <h2 class="shopbycat__title">{{ section.settings.heading }}</h2>

      {% if section.settings.view_more_link != blank %}
        <a href="{{ section.settings.view_more_link }}" class="shopbycat__more">
          {{ section.settings.view_more_text }} →
        </a>
      {% endif %}
    </div>

    <div class="shopbycat__grid shopbycat__grid--{{ count }}">
      {% for block in section.blocks %}
        <a href="{{ block.settings.link }}" class="shopbycat__item item-{{ forloop.index }}">
          {% if block.settings.image %}
            <img
              src="{{ block.settings.image | image_url: width: 1200 }}"
              alt="{{ block.settings.title | escape }}"
              loading="lazy"
            >
          {% endif %}

          <div class="shopbycat__label">
            <h3>{{ block.settings.title }}</h3>
            <span>{{ block.settings.subtitle }}</span>
          </div>
        </a>
      {% endfor %}
    </div>

  </div>
</section>

<style>
/* Section background + vertical spacing */
.shopbycat{
  background: #f6f7f2;
  padding: 48px 0 28px;
}

/* ✅ DON'T hard-limit width. Use theme container, only add safe padding. */
.shopbycat__container{
  padding-left: 24px !important;
  padding-right: 24px !important;
}

/* Header row */
.shopbycat__head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap: 16px;
  margin-bottom: 26px;
}

.shopbycat__title{
  margin:0;
  font-size: 32px;
  line-height: 1.1;
  color: #1f3d2b;
}

/* View more visible */
.shopbycat__more{
  font-size: 14px;
  color: #1f3d2b;
  text-decoration:none;
  white-space:nowrap;
  opacity: .9;
}
.shopbycat__more:hover{ text-decoration: underline; opacity: 1; }

/* Cards */
.shopbycat__grid{
  display:grid;
  gap: 20px;
}

.shopbycat__item{
  position:relative;
  display:block;
  border-radius: 18px;
  overflow:hidden;
  background:#fff;
  box-shadow: 0 6px 18px rgba(0,0,0,.08);
  min-height: 220px;
}

.shopbycat__item img{
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  transition: transform .35s ease;
}
.shopbycat__item:hover img{ transform: scale(1.04); }

/* Label like your screenshot (light box) */
.shopbycat__label{
  position:absolute;
  top: 14px;
  left: 14px;
  background: rgba(255,255,255,.92);
  border-radius: 12px;
  padding: 10px 14px;
  color:#1f3d2b;
  max-width: 78%;
}

.shopbycat__label h3{
  margin:0;
  font-size: 16px;
  font-weight: 600;
}
.shopbycat__label span{
  display:block;
  margin-top: 2px;
  font-size: 13px;
  opacity:.8;
}

/* ✅ Layout rules by count (1–5 only) */
/* 1 */
.shopbycat__grid--1{ grid-template-columns: 1fr; }

/* 2 */
.shopbycat__grid--2{ grid-template-columns: repeat(2, 1fr); }

/* 3 */
.shopbycat__grid--3{ grid-template-columns: repeat(3, 1fr); }

/* 4 */
.shopbycat__grid--4{ grid-template-columns: repeat(4, 1fr); }

/* 5 = featured layout exactly like your design */
.shopbycat__grid--5{
  grid-template-columns: 1fr 2fr 1fr 1fr;
  grid-template-rows: repeat(2, 220px);
}
.shopbycat__grid--5 .item-1{ grid-row: span 2; }
.shopbycat__grid--5 .item-2{ grid-row: span 2; }
.shopbycat__grid--5 .item-5{ grid-column: span 2; }

/* Mobile */
@media (max-width: 990px){
  .shopbycat__title{ font-size: 26px; }
  .shopbycat__container{
    padding-left: 16px !important;
    padding-right: 16px !important;
  }
  .shopbycat__grid--4{ grid-template-columns: repeat(2, 1fr); }
  .shopbycat__grid--3{ grid-template-columns: repeat(2, 1fr); }
  .shopbycat__grid--2{ grid-template-columns: repeat(2, 1fr); }
  .shopbycat__grid--5{
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: auto;
  }
  .shopbycat__grid--5 .item-1,
  .shopbycat__grid--5 .item-2,
  .shopbycat__grid--5 .item-5{
    grid-column: span 2;
    grid-row: span 1;
    min-height: 200px;
  }
}
</style>

{% schema %}
{
  "name": "Shop by Category",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Shop by Category"
    },
    {
      "type": "text",
      "id": "view_more_text",
      "label": "View more text",
      "default": "View more"
    },
    {
      "type": "url",
      "id": "view_more_link",
      "label": "View more link"
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Category",
      "settings": [
        { "type": "image_picker", "id": "image", "label": "Image" },
        { "type": "text", "id": "title", "label": "Title", "default": "Indoor Plants" },
        { "type": "text", "id": "subtitle", "label": "Subtitle", "default": "Shop Now" },
        { "type": "url", "id": "link", "label": "Collection link" }
      ]
    }
  ],
  "max_blocks": 5,
  "presets": [
    { "name": "Shop by Category" }
  ]
}
{% endschema %}
